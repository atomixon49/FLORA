
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }}</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .metric-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }
        .metric-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }
        .metric-label {
            color: #666;
            margin-top: 5px;
        }
        .status-healthy { color: #28a745; }
        .status-warning { color: #ffc107; }
        .status-critical { color: #dc3545; }
        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .refresh-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 20px;
        }
        .refresh-btn:hover {
            background: #5a6fd8;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üå∏ FLORA Security Dashboard</h1>
        <p>Monitoreo de Seguridad en Tiempo Real - {{ timestamp }}</p>
    </div>
    
    <button class="refresh-btn" onclick="loadData()">üîÑ Actualizar Datos</button>
    
    <div class="metrics-grid" id="metricsGrid">
        <!-- Las m√©tricas se cargar√°n aqu√≠ -->
    </div>
    
    <div class="chart-container">
        <h3>üìä Eventos Recientes</h3>
        <div id="recentEvents">
            <!-- Los eventos se cargar√°n aqu√≠ -->
        </div>
    </div>
    
    <div class="chart-container">
        <h3>üõ°Ô∏è Estado de Compliance</h3>
        <div id="complianceStatus">
            <!-- El estado de compliance se cargar√° aqu√≠ -->
        </div>
    </div>
    
    <div class="chart-container">
        <h3>‚ö†Ô∏è Amenazas Detectadas</h3>
        <div id="threatsDetected">
            <!-- Las amenazas se cargar√°n aqu√≠ -->
        </div>
    </div>

    <script>
        async function loadData() {
            try {
                // Cargar m√©tricas de seguridad
                const metricsResponse = await fetch('/api/security/metrics');
                const metrics = await metricsResponse.json();
                
                // Cargar estado de compliance
                const complianceResponse = await fetch('/api/compliance/status');
                const compliance = await complianceResponse.json();
                
                // Cargar amenazas detectadas
                const threatsResponse = await fetch('/api/threats/detected');
                const threats = await threatsResponse.json();
                
                // Cargar salud de seguridad
                const healthResponse = await fetch('/api/security/health');
                const health = await healthResponse.json();
                
                updateMetrics(metrics, health);
                updateRecentEvents(metrics);
                updateCompliance(compliance);
                updateThreats(threats);
                
            } catch (error) {
                console.error('Error al cargar datos:', error);
            }
        }
        
        function updateMetrics(metrics, health) {
            const grid = document.getElementById('metricsGrid');
            grid.innerHTML = `
                <div class="metric-card">
                    <div class="metric-value">${metrics.total_events}</div>
                    <div class="metric-label">Eventos (24h)</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">${(metrics.success_rate * 100).toFixed(1)}%</div>
                    <div class="metric-label">Tasa de √âxito</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value status-${health.status}">${health.health_score}</div>
                    <div class="metric-label">Puntuaci√≥n de Salud</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">${metrics.threat_detections}</div>
                    <div class="metric-label">Amenazas Detectadas</div>
                </div>
            `;
        }
        
        function updateRecentEvents(metrics) {
            const container = document.getElementById('recentEvents');
            const events = metrics.recent_events.slice(0, 5);
            
            container.innerHTML = events.map(event => `
                <div style="padding: 10px; border-left: 4px solid ${event.success ? '#28a745' : '#dc3545'}; margin-bottom: 10px; background: #f8f9fa;">
                    <strong>${event.operation}</strong> - ${event.threat_level} - ${event.timestamp}
                </div>
            `).join('');
        }
        
        function updateCompliance(compliance) {
            const container = document.getElementById('complianceStatus');
            const percentages = compliance.compliance_percentages;
            
            container.innerHTML = Object.entries(percentages).map(([standard, percentage]) => `
                <div style="margin-bottom: 10px;">
                    <strong>${standard.toUpperCase()}:</strong> 
                    <span class="status-${percentage >= 80 ? 'healthy' : percentage >= 60 ? 'warning' : 'critical'}">
                        ${percentage.toFixed(1)}%
                    </span>
                </div>
            `).join('');
        }
        
        function updateThreats(threats) {
            const container = document.getElementById('threatsDetected');
            const threatList = threats.threats.slice(0, 5);
            
            if (threatList.length === 0) {
                container.innerHTML = '<p>‚úÖ No hay amenazas activas</p>';
                return;
            }
            
            container.innerHTML = threatList.map(threat => `
                <div style="padding: 10px; border-left: 4px solid ${threat.severity === 'critical' ? '#dc3545' : threat.severity === 'high' ? '#fd7e14' : '#ffc107'}; margin-bottom: 10px; background: #f8f9fa;">
                    <strong>${threat.pattern_id}</strong> - ${threat.severity} - ${threat.timestamp}
                    ${threat.mitigated ? '<span style="color: #28a745;">‚úÖ Mitigada</span>' : '<span style="color: #dc3545;">‚ö†Ô∏è Activa</span>'}
                </div>
            `).join('');
        }
        
        // Cargar datos al cargar la p√°gina
        loadData();
        
        // Actualizar cada 30 segundos
        setInterval(loadData, 30000);
    </script>
</body>
</html>
